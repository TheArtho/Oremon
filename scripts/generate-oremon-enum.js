const fs = require("fs-extra");
const path = require("path");
const Database = require("better-sqlite3");

const db = new Database(path.join(__dirname, "../db/veekun-pokedex.sqlite"));
const outputPath = path.join(__dirname, "../src/enums/oremonIds.ts");

// Query all PokÃ©mon species
const rows = db
    .prepare("SELECT identifier FROM pokemon_species ORDER BY id ASC")
    .all();

// Convert to Enum entries
const entries = rows.map(row => {
    const enumKey = row.identifier
        .replace(/-/g, "_")
        .replace(/[^a-zA-Z0-9_]/g, "")
        .replace(/^[0-9]/, "_$&"); // avoid numeric prefix
    return `    ${capitalize(enumKey)} = "oremon:${row.identifier.toLowerCase()}"`;
});

function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

// Compose the TypeScript file content
const content = `// Auto-generated Oremon IDs enum
// Generated by generate-oremon-enum.js

export enum OremonSpecies {
${entries.join(",\n")}
}
`;

fs.ensureDirSync(path.dirname(outputPath));
fs.writeFileSync(outputPath, content, "utf8");
console.log("\x1b[32moremonIds.ts has been generated!\x1b[0m");
